---
import Layout from '../../layouts/Layout.astro';
import SponsorStrip from '../../components/SponsorStrip.astro';
import eventsData from '../../data/events.json';

export function getStaticPaths() {
  const upcoming = eventsData.events.map(event => ({
    params: { slug: event.id },
    props: { event }
  }));
  
  const past = eventsData.past_events.map(event => ({
    params: { slug: event.id },
    props: { event: { ...event, status: 'past' } }
  }));
  
  return [...upcoming, ...past];
}

const { event } = Astro.props;
const readyDocuments = event.documents?.filter(d => d.is_ready) || [];
const hasSchedule = event.schedule && event.schedule.length > 0;
const hasDeadlines = event.deadlines && event.deadlines.length > 0;
const venueFinal = event.venue?.is_final;
---

<Layout title={`${event.full_name} | Smite Club`}>
  <style>
    .hero {
      background: linear-gradient(135deg, #0a0a1a 0%, #1e293b 100%);
      padding: 80px 0 60px;
      text-align: center;
      color: white;
    }
    
    .hero h1 {
      font-size: 46px;
      margin-bottom: 15px;
    }
    
    .hero .subtitle {
      font-size: 20px;
      color: #c9a45c;
      margin-bottom: 10px;
    }
    
    .hero .meta {
      font-size: 17px;
      color: #94a3b8;
      margin-bottom: 30px;
    }
    
    .hero-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .hero .btn {
      font-size: 15px;
      padding: 14px 28px;
    }
    
    .hero .btn-primary {
      background: #c9a45c;
      color: #0a0a1a;
    }
    
    .hero .btn-outline {
      border-color: #7dd3fc;
      color: #7dd3fc;
    }
    
    .section {
      padding: 60px 0;
    }
    
    .section-title {
      font-size: 28px;
      margin-bottom: 30px;
      color: #0a0a1a;
    }
    
    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 50px;
    }
    
    .quick-facts {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .fact {
      background: #f8fafc;
      padding: 20px;
      border-radius: 8px;
    }
    
    .fact-label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #64748b;
      margin-bottom: 8px;
    }
    
    .fact-value {
      font-size: 18px;
      font-weight: 700;
      color: #0a0a1a;
    }
    
    .card {
      background: #ffffff;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
    }
    
    .card h3 {
      font-size: 20px;
      margin-bottom: 15px;
      color: #0a0a1a;
    }
    
    .card ul {
      color: #475569;
      padding-left: 20px;
    }
    
    .card li {
      margin: 10px 0;
    }
    
    .differentiators {
      background: #f0f9ff;
      border-left: 4px solid #0ea5e9;
      padding: 25px;
      margin-bottom: 30px;
    }
    
    .differentiators h3 {
      font-size: 18px;
      margin-bottom: 15px;
      color: #0a0a1a;
    }
    
    .differentiators ul {
      margin: 0;
      padding-left: 20px;
      color: #475569;
    }
    
    .differentiators li {
      margin: 8px 0;
    }
    
    .schedule-day {
      margin-bottom: 25px;
    }
    
    .schedule-day h4 {
      font-size: 17px;
      color: #0a0a1a;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e2e8f0;
    }
    
    .schedule-item {
      display: flex;
      gap: 20px;
      padding: 10px 0;
      border-bottom: 1px solid #f1f5f9;
    }
    
    .schedule-time {
      font-weight: 700;
      color: #0a0a1a;
      min-width: 90px;
    }
    
    .docs-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .docs-table th,
    .docs-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .docs-table th {
      background: #f8fafc;
      font-weight: 700;
      color: #0a0a1a;
      font-size: 13px;
      text-transform: uppercase;
    }
    
    .faq-item {
      margin-bottom: 25px;
      padding-bottom: 25px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .faq-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .faq-q {
      font-weight: 700;
      color: #0a0a1a;
      margin-bottom: 8px;
    }
    
    .faq-a {
      color: #475569;
    }
    
    .community-block {
      background: #f8fafc;
      padding: 30px;
      border-radius: 12px;
      text-align: center;
    }
    
    .community-block h3 {
      font-size: 18px;
      margin-bottom: 10px;
      color: #0a0a1a;
    }
    
    .community-block p {
      color: #64748b;
      margin: 0;
    }
    
    .tbd-notice {
      background: #f8fafc;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 20px;
      color: #64748b;
      text-align: center;
    }
    
    @media (max-width: 768px) {
      .two-col {
        grid-template-columns: 1fr;
      }
      .hero h1 {
        font-size: 34px;
      }
    }
  </style>

  <!-- HERO -->
  <section class="hero">
    <div class="container">
      <p class="subtitle">{event.is_flagship ? 'Flagship Event' : 'Flagship Event Series'}</p>
      <h1>{event.full_name}</h1>
      <p class="meta">üìÖ {event.date_range_display} ‚Ä¢ üìç {event.venue?.name || 'Phoenix, Arizona'}</p>
      
      <div class="hero-buttons">
        {event.primary_cta?.url && (
          <a href={event.primary_cta.url} class="btn btn-primary">{event.primary_cta.label}</a>
        )}
        {event.secondary_ctas?.map(cta => (
          <a href={cta.url} class="btn btn-outline">{cta.label}</a>
        ))}
      </div>
    </div>
  </section>

  <!-- QUICK FACTS -->
  <section class="section">
    <div class="container">
      <div class="quick-facts">
        <div class="fact">
          <div class="fact-label">Format</div>
          <div class="fact-value">{event.format?.rounds || '5'} Rounds</div>
        </div>
        <div class="fact">
          <div class="fact-label">Points</div>
          <div class="fact-value">{event.format?.points_cap || '2,000'}</div>
        </div>
        <div class="fact">
          <div class="fact-label">Terrain</div>
          <div class="fact-value">{event.format?.terrain || 'GW Layouts'}</div>
        </div>
        {event.games && (
          <div class="fact">
            <div class="fact-label">Game Systems</div>
            <div class="fact-value">{event.games.length}</div>
          </div>
        )}
      </div>
    </div>
  </section>

  <!-- DIFFERENTIATORS -->
  {event.differentiators && event.differentiators.length > 0 && (
    <section class="section" style="background: #f8fafc;">
      <div class="container">
        <div class="differentiators">
          <h3>What makes this event different</h3>
          <ul>
            {event.differentiators.map(d => (
              <li>{d}</li>
            ))}
          </ul>
        </div>
      </div>
    </section>
  )}

  <!-- WHAT YOU GET -->
  <section class="section" style="background: #f8fafc;">
    <div class="container">
      <h2 class="section-title">What you get</h2>
      <div class="two-col">
        <div class="card">
          <h3>üé® Premium Terrain</h3>
          <ul>
            <li>GW official table layouts</li>
            <li>Premium, painted terrain pieces</li>
            <li>Consistent, tournament-ready boards</li>
          </ul>
        </div>
        <div class="card">
          <h3>üèÜ Competitive Prizing</h3>
          <ul>
            <li>{event.prizing || 'Custom awards and prizes'}</li>
            <li>Top finishers recognized</li>
            <li>Multiple game system support</li>
          </ul>
        </div>
        <div class="card">
          <h3>‚öñÔ∏è Expert Judges</h3>
          <ul>
            <li>Experienced judge team</li>
            <li>Consistent, fair rulings</li>
            <li>Pre-event rules clarifications</li>
          </ul>
        </div>
        <div class="card">
          <h3>ü§ù Player Community</h3>
          <ul>
            <li>Players travel from across the Southwest</li>
            <li>Active Discord community</li>
            <li>Post-event socials</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- SCHEDULE -->
  {hasSchedule ? (
    <section class="section">
      <div class="container">
        <h2 class="section-title">Event Schedule</h2>
        <div class="two-col">
          {event.schedule.map(day => (
            <div class="card">
              <div class="schedule-day">
                <h4>{day.day_label}</h4>
                {day.items.map(item => (
                  <div class="schedule-item">
                    <span class="schedule-time">{item.time}</span>
                    <span style="color: #475569;">{item.title}{item.note && ` ‚Äî ${item.note}`}</span>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  ) : (
    <section class="section">
      <div class="container">
        <h2 class="section-title">Event Format</h2>
        <div class="card">
          <p style="color: #475569;">
            <strong>Saturday:</strong> Registration, Rounds 1‚Äì3<br/>
            <strong>Sunday:</strong> Rounds 4‚Äì5, Awards Ceremony<br/><br/>
            Detailed schedule will be posted when venue is confirmed.
          </p>
        </div>
      </div>
    </section>
  )}

  <!-- VENUE -->
  <section class="section" style="background: #f8fafc;">
    <div class="container">
      <h2 class="section-title">Venue</h2>
      <div class="two-col">
        <div>
          <h3 style="font-size: 22px; margin-bottom: 10px;">{event.venue?.name || 'Venue TBA'}</h3>
          {venueFinal ? (
            <>
              <p style="color: #475569; margin-bottom: 20px;">{event.venue?.address}</p>
              <p style="color: #64748b; font-size: 14px; line-height: 1.6;">
                Free parking available. Hotel recommendations and directions will be in the Player Packet.
              </p>
              {event.venue?.maps_url && (
                <a href={event.venue.maps_url} target="_blank" class="btn" style="margin-top: 15px;">View on Map</a>
              )}
            </>
          ) : (
            <p style="color: #64748b;">Venue details will be posted here when confirmed.</p>
          )}
        </div>
        <div class="card" style="display: flex; align-items: center; justify-content: center; min-height: 200px;">
          {venueFinal ? (
            <p style="color: #94a3b8;">[Map integration would appear here]</p>
          ) : (
            <p style="color: #94a3b8;">Map available once venue confirmed</p>
          )}
        </div>
      </div>
    </div>
  </section>

  <!-- KEY DEADLINES -->
  {hasDeadlines && (
    <section class="section">
      <div class="container">
        <h2 class="section-title">Key Deadlines</h2>
        <div class="card">
          {event.deadlines.map(d => (
            <div style="display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #e2e8f0;">
              <div>
                <strong style="color: #0a0a1a;">{d.label}</strong>
                <p style="color: #64748b; font-size: 14px; margin: 5px 0 0;">{d.note}</p>
              </div>
              <span style="color: #c9a45c; font-weight: 700; white-space: nowrap;">{d.date}</span>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- DOCUMENTS -->
  {readyDocuments.length > 0 && (
    <section class="section" style="background: #f8fafc;">
      <div class="container">
        <h2 class="section-title">Downloads & Resources</h2>
        <div class="card">
          <table class="docs-table">
            <thead>
              <tr>
                <th>Document</th>
                <th>For</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {readyDocuments.map(doc => (
                <tr>
                  <td>{doc.title}</td>
                  <td style="color: #64748b; font-size: 14px;">{doc.audience}</td>
                  <td style="text-align: right;">
                    <a href={doc.url} class="btn" style="padding: 8px 16px; font-size: 13px;">
                      {doc.type === 'PDF' ? 'Download' : 'View'}
                    </a>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </section>
  )}

  <!-- FAQ -->
  {event.faqs && event.faqs.length > 0 && (
    <section class="section">
      <div class="container">
        <h2 class="section-title">FAQ</h2>
        <div class="card">
          {event.faqs.map((faq, i) => (
            <div class="faq-item">
              <p class="faq-q">{faq.q}</p>
              <p class="faq-a">{faq.a}</p>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- COMMUNITY -->
  {event.community_note && (
    <section class="section" style="background: #f8fafc;">
      <div class="container">
        <div class="community-block">
          <h3>Community</h3>
          <p>{event.community_note}</p>
        </div>
      </div>
    </section>
  )}

  <!-- SPONSORS -->
  <SponsorStrip title="Event Sponsors" sponsors={event.sponsors} />
</Layout>
